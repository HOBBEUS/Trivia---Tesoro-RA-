<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Juego AR - Cofre del Tesoro</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.loaders.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #question-panel {
        position: absolute;
        top: 20px;
        width: 100%;
        text-align: center;
        display: none; /* Oculto al inicio */
      }
      .question-text {
        color: white;
        font-size: 1.5em;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <div id="question-panel">
      <div class="question-text" id="question"></div>
      <button onclick="answer('A')">A</button>
      <button onclick="answer('B')">B</button>
      <button onclick="answer('C')">C</button>
    </div>
    
    <a-scene embedded arjs>
      <a-marker id="marcador" type="pattern" url="miimagen.patt">
        <a-entity id="cofre" gltf-model="cofre.glb" position="0 0 0" scale="0.5 0.5 0.5" animation-mixer></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const panel = document.getElementById('question-panel');
      const preguntaElement = document.getElementById('question');
      const botones = document.querySelectorAll('#question-panel button');
      const cofre = document.querySelector('#cofre');
      const marcador = document.querySelector('#marcador');

      let preguntaActual = 0;
      let respuestasCorrectas = 0;
      const preguntas = [
        { pregunta: "¿Cuál es la capital de Francia?", respuestaCorrecta: 'B' },
        { pregunta: "¿Cuántos continentes hay?", respuestaCorrecta: 'A' },
        { pregunta: "¿Cuál es el océano más grande?", respuestaCorrecta: 'B' }
      ];
      const respuestas = [
        ['A) Madrid', 'B) París', 'C) Roma'],
        ['A) 7', 'B) 6', 'C) 5'],
        ['A) Atlántico', 'B) Pacífico', 'C) Índico']
      ];

      // Mostrar pregunta actual
      function cargarPregunta() {
        preguntaElement.textContent = preguntas[preguntaActual].pregunta;
        botones[0].textContent = respuestas[preguntaActual][0];
        botones[1].textContent = respuestas[preguntaActual][1];
        botones[2].textContent = respuestas[preguntaActual][2];
      }

      // Lógica al responder
      function answer(selectedAnswer) {
        if (selectedAnswer === preguntas[preguntaActual].respuestaCorrecta) {
          respuestasCorrectas++;
          if (respuestasCorrectas === preguntas.length) {
            abrirCofre();
          }
        }
        preguntaActual++;
        if (preguntaActual < preguntas.length) {
          cargarPregunta();
        } else {
          preguntaElement.textContent = "¡Juego terminado!";
          botones.forEach(btn => btn.style.display = "none");
        }
      }

      // Animación de abrir el cofre
      function abrirCofre() {
        const mixer = cofre.components['animation-mixer'].mixer;
        if (mixer) {
          const clip = mixer._actions[0];
          clip.reset().play();
        }
      }

      // Mostrar panel cuando se detecte el marcador
      marcador.addEventListener('markerFound', () => {
        panel.style.display = 'block';
        cargarPregunta();
      });

      marcador.addEventListener('markerLost', () => {
        panel.style.display = 'none'; // Oculta si se pierde el marcador
      });
    </script>
  </body>
</html>
